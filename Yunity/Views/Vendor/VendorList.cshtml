@model List<Yunity.Models.CCompanyInfoWrap>

@{
    ViewData["Title"] = "廠商列表";
    string defaultSortParam = ViewBag.CurrentSort == "default" ? "default_desc" : "default";
    string statusSortParam = ViewBag.CurrentSort == "status" ? "status_desc" : "status";
    string recentEndDateSortParam = ViewBag.CurrentSort == "recent_end_date" ? "recent_end_date_desc" : "recent_end_date";
}
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.21/dist/sweetalert2.min.css" rel="stylesheet" />



<div class="container">
    <div style=" margin-left:10%">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="@Url.Action("Index","Home")" class="breadcrumb-item active" aria-current="page">
                        首頁
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="@Url.Action("VendorList","Vendor")" class="breadcrumb-item active" aria-current="page" style="color:#293C56 ;">
                        廠商管理
                    </a>
                </li>
            </ol>
        </nav>
        @using (Html.BeginForm())
        {
            <div class="container mb-3">
                <div class="row align-items-center">
                    <div class="col-md-3"></div>
                    <div class="col-md-6">
                        <div class="input-group">
                            @Html.TextBox("txtKeyword", null, new { @class = "form-control", placeholder = "廠商名稱 or 服務項目" })
                            <button type="submit" class="btn btn-outline-secondary"><i class="bi bi-search rounded-end"></i></button>
                        </div>
                    </div>
                    <div class="col-md-3 ">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle sort-botton" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                排序
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item sort-link" href="#" data-sort="@defaultSortParam">預設</a></li>
                                <li><a class="dropdown-item sort-link" href="#" data-sort="@statusSortParam">狀態</a></li>
                                <li><a class="dropdown-item sort-link" href="#" data-sort="@recentEndDateSortParam">最近合約結束日</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        }

        <div id="vendorList">
            @Html.Partial("_VendorListPartial", Model)
        </div>

        <a asp-action="Create" class="create-link" style="position: fixed; bottom: 20px; right: 20px;">
            <i class="bi bi-plus-circle-fill" style="font-size:3rem; color:#ff914d"></i>
        </a>
    </div>
</div>

@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.21/dist/sweetalert2.min.js"></script>

    <script>
        @if (TempData["Message"] != null)
        {
            <text>
                    Swal.fire({
                        icon: 'success',
                        title: '成功',
                        html: '@Html.Raw(TempData["Message"])',  // 使用 Html.Raw() 顯示 HTML 實體碼
                        confirmButtonText: 'OK'
                    });
            </text>
        }
    </script>

    <script>

        function ShowStatus()
        {
            $('td[data-status]').each(function () {
                var s = $(this).data('status');
                if (s === 1)
                {
                    $(this).text('正常').css('color', 'green');
                }
                else if (s === 0)
                {
                    $(this).text('停用').css('color', 'red');
                }
            });
        }

        $(document).ready(function () {
            ShowStatus();

            $('.sort-link').click(function (e) {
                e.preventDefault();
                var sortOrder = $(this).data('sort');
                $.ajax({
                    url: '@Url.Action("VendorList", "Vendor")',
                    data: { sortOrder: sortOrder },
                    success: function (result) {
                        $('#vendorList').html(result);
                        ShowStatus();
                    }
                });
            });
        });

    </script>
}

